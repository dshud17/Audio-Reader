<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Reader Pro</title>

    <link rel="icon" type="image/png" href="icon.png?v=99">
    <link rel="apple-touch-icon" href="icon.png?v=99">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: #0f0f0f;
            color: #ffffff;
            transition: background 0.3s;
        }

        /* Modern App Header */
        .app-header {
            display: flex;
            align-items: center;
            padding: 12px 18px;
            background: #1a1a1a;
            border-bottom: 2px solid #333;
        }

        .app-logo {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            margin-right: 12px;
            object-fit: cover;
            border: 1px solid #444;
        }

        .app-title {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 800;
            letter-spacing: 0.5px;
            color: #4285F4;
            text-transform: uppercase;
        }

        #toolbar {
            padding: 15px;
            background: #1a1a1a;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        button {
            padding: 10px 16px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            background: #333;
            color: #eee;
            transition: all 0.2s ease;
            flex-grow: 1;
            max-width: 120px;
        }

        button:active { transform: scale(0.92); }
        .btn-play { background: #4285F4; color: white; }
        .btn-stop { background: #EA4335; color: white; }
        .btn-imm { background: #34A853; color: white; }

        .slider-box {
            width: 100%;
            display: flex;
            align-items: center;
            background: #252525;
            padding: 8px 12px;
            border-radius: 8px;
            margin-top: 5px;
        }

        .label-text { font-size: 12px; color: #aaa; min-width: 50px; }
        input[type="range"] { flex-grow: 1; margin: 0 10px; }

        #textInput {
            width: 100%;
            height: 110px;
            font-size: 15px;
            padding: 15px;
            box-sizing: border-box;
            background: #111;
            color: #999;
            border: none;
            outline: none;
            border-bottom: 2px solid #333;
        }

        #textDisplay {
            width: 100%;
            height: calc(100vh - 360px);
            font-size: 28px;
            font-weight: 700;
            line-height: 1.7;
            padding: 25px;
            box-sizing: border-box;
            white-space: pre-wrap;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .sentence { cursor: pointer; transition: 0.2s; border-radius: 5px; display: inline; }
        .highlight { background: rgba(66, 133, 244, 0.4); color: #fff; border-bottom: 3px solid #4285F4; }

        .white-mode { background: #ffffff !important; color: #111 !important; }
        .white-mode .app-header, .white-mode #toolbar { background: #f0f0f0; border-color: #ccc; }
        .white-mode button { background: #ddd; color: #333; }
        .white-mode .slider-box { background: #e0e0e0; }

        /* üìñ Immersive Reader Mode */
        .immersive .app-header, .immersive #toolbar, .immersive #textInput { display: none !important; }
        .immersive #textDisplay {
            height: 100vh;
            font-size: 40px;
            padding: 50px 30px;
            background: #000;
        }

        #exitBtn {
            display: none;
            position: fixed;
            top: 25px;
            right: 25px;
            background: #EA4335;
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            font-weight: 900;
            z-index: 9999;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .immersive #exitBtn { display: block; }

    </style>
</head>
<body>

<button id="exitBtn" onclick="exitImmersive()">EXIT ‚ùå</button>

<div class="app-header">
    <img src="icon.png?v=99" alt="Logo" class="app-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3767/3767084.png'">
    <h2 class="app-title">Smart Reader Pro</h2>
</div>

<div id="toolbar">
    <button class="btn-play" onclick="playText()">PLAY ‚ñ∂</button>
    <button onclick="pauseText()">PAUSE ‚è∏</button>
    <button onclick="resumeText()">RESUME ‚èØ</button>
    <button class="btn-stop" onclick="stopText()">STOP ‚èπ</button>
    <button onclick="toggleDark()">MODE üåô</button>
    <button class="btn-imm" onclick="enterImmersive()">READING üìñ</button>
    <button onclick="clearText()">CLEAR üóë</button>

    <div class="slider-box">
        <span class="label-text">Speed</span>
        <input type="range" id="speedControl" min="0.5" max="2" step="0.1" value="1">
    </div>
    
    <div class="slider-box">
        <span class="label-text">Zoom</span>
        <input type="range" id="zoomControl" min="20" max="60" value="28" oninput="changeZoom()">
    </div>
</div>

<textarea id="textInput" placeholder="Yahan apna text paste karein...">
In most situations there's nothing to deal with except your own fears and desires. Fear and desire make everything seem complicated. If you don't have fear or desire about an event, there‚Äôs really nothing to deal with.
</textarea>

<div id="textDisplay"></div>

<script>
    let synth = window.speechSynthesis;
    let utter;
    let sentences = [];
    let index = 0;
    let isPaused = false;

    // Load voices correctly
    function getHindiVoice() {
        let voices = synth.getVoices();
        let hindiVoice = voices.find(v => v.lang.toLowerCase().includes("hi"));
        return hindiVoice || voices[0];
    }

    function splitSentences(text) {
        let arr = text.match(/[^\.!\?]+[\.!\?]+/g);
        return arr ? arr : [text];
    }

    function renderText() {
        let text = document.getElementById("textInput").value.trim();
        sentences = splitSentences(text);
        let html = "";
        sentences.forEach((s, i) => {
            html += `<span class="sentence" id="s${i}" onclick="startFrom(${i})">${s} </span>`;
        });
        document.getElementById("textDisplay").innerHTML = html;
    }

    function playText() {
        stopText();
        renderText();
        index = 0;
        speakSentence();
    }

    function startFrom(i) {
        stopText();
        index = i;
        speakSentence();
    }

    function speakSentence() {
        if (index >= sentences.length) {
            index = 0;
            return;
        }

        utter = new SpeechSynthesisUtterance(sentences[index]);
        utter.rate = document.getElementById("speedControl").value;
        let voice = getHindiVoice();
        if (voice) utter.voice = voice;

        highlightSentence();

        utter.onend = function() {
            if (!isPaused) {
                index++;
                speakSentence();
            }
        };
        synth.speak(utter);
    }

    function highlightSentence() {
        document.querySelectorAll(".sentence").forEach(el => el.classList.remove("highlight"));
        let current = document.getElementById("s" + index);
        if (current) {
            current.classList.add("highlight");
            current.scrollIntoView({ behavior: "smooth", block: "center" });
        }
    }

    function pauseText() { if (synth.speaking) { synth.pause(); isPaused = true; } }
    function resumeText() { if (synth.paused) { synth.resume(); isPaused = false; } }
    function stopText() { synth.cancel(); isPaused = false; }
    function clearText() { stopText(); document.getElementById("textInput").value = ""; document.getElementById("textDisplay").innerHTML = ""; }
    function toggleDark() { document.body.classList.toggle("white-mode"); }
    function changeZoom() { document.getElementById("textDisplay").style.fontSize = document.getElementById("zoomControl").value + "px"; }
    
    function enterImmersive() {
        document.body.classList.add("immersive");
        if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
    }

    function exitImmersive() {
        document.body.classList.remove("immersive");
        if (document.fullscreenElement) document.exitFullscreen();
    }

    // Fixed: Initial Load
    window.onload = renderText;
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = getHindiVoice;
    }
</script>

</body>
</html>
